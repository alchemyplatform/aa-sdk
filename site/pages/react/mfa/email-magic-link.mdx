---
title: Email Magic Link with Multi-Factor Authentication
description: How to authenticate users with Email Magic Link and MFA in your React app
---

# Email Magic Link with Multi-Factor Authentication

This guide shows you how to implement authentication with Email Magic Link and TOTP-based multi-factor authentication in your React application.

## Overview

When a user has MFA enabled with an authenticator app (TOTP), the login flow requires two steps:

1. The user enters their email address to request a magic link
2. If MFA is enabled for their account, they're prompted to enter the 6-digit TOTP code from their authenticator app (e.g., Google Authenticator)
3. After entering a valid TOTP code, a magic link is sent to their email
4. The user clicks the magic link from email to complete authentication
5. Upon successful verification, the user is authenticated and redirected to the appropriate page

This two-factor approach provides an additional layer of security beyond a standard magic link.

## Implementation

### Step 1: Send the Magic Link with MFA Handling

When sending a magic link to a user with MFA enabled, you need to handle both parts of the authentication flow:

```tsx twoslash
import React from "react";
import { useAuthenticate } from "@account-kit/react";
import { MfaRequiredError } from "@account-kit/signer";
import { useState } from "react";

function MagicLinkWithMFA() {
  const [mfaData, setMfaData] = useState({ email: "", multiFactorId: "" });
  const [showTotpInput, setShowTotpInput] = useState(false);
  const [totpCode, setTotpCode] = useState("");
  const { authenticate } = useAuthenticate();

  // When the user submits their email to receive a magic link
  const handleSendMagicLink = (email: string) => {
    authenticate(
      {
        type: "email",
        emailMode: "magicLink",
        email,
      },
      {
        onSuccess: () => {
          // This callback only fires when the entire auth flow is complete
          // (user clicked magic link and completed MFA if required)
          console.log("Authentication successful!");
        },
        onError: (error) => {
          // If MFA is required the attempt will result in an MfaRequiredError
          if (error instanceof MfaRequiredError) {
            const { multiFactorId } = error.multiFactors[0];

            // Store this information to use when the user enters their TOTP code
            setMfaData({ email, multiFactorId });
            setShowTotpInput(true);
          }
          // Handle other errors
        },
      }
    );
  };

  // Add a handler for the TOTP input
  const handleTotpChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setTotpCode(e.target.value);
  };

  // When the user provides the TOTP code
  const handleMagicLinkWithMFA = () => {
    authenticate(
      {
        type: "email",
        emailMode: "magicLink",
        email: mfaData.email,
        // The multiFactors array tells the authentication system which
        // factor to verify and what code to use
        multiFactors: [
          {
            multiFactorId: mfaData.multiFactorId,
            multiFactorCode: totpCode,
          },
        ],
      },
      {
        onSuccess: () => {
          // This callback will only fire after the user has clicked the magic link and the email has been verified
        },
        onError: (error) => {
          // Handle error
        },
      }
    );
  };

  return <div>{/* Your UI components here */}</div>;
}
```

### Step 2: Handle the Magic Link Redirect

When the user clicks the magic link in their email, your application needs to handle the redirect and complete the authentication:

```tsx twoslash
import React, { useEffect } from "react";
import { useAuthenticate } from "@account-kit/react";

// Inside your component
const { authenticate } = useAuthenticate();

const handleMagicLinkRedirect = () => {
  const url = new URL(window.location.href);
  const bundle = url.searchParams.get("bundle");

  // If there's no bundle parameter, this isn't a magic link redirect
  if (!bundle) return;

  authenticate(
    {
      type: "email",
      bundle,
    },
    {
      onSuccess: () => {
        // Authentication successful!
      },
      onError: (error) => {
        // Handle error
      },
    }
  );
};

// Call this function when the component mounts
useEffect(() => {
  handleMagicLinkRedirect();
}, []);
```

## Next Steps

- [Set up MFA for your users](/react/mfa/setup-mfa)
- [Implement Email OTP with MFA](/react/mfa/email-otp)
