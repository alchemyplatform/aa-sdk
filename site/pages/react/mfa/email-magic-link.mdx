---
title: Email Magic Link with Multi-Factor Authentication
description: How to authenticate users with Email Magic Link and MFA in your React app
---

# Email Magic Link with Multi-Factor Authentication

This guide shows you how to implement authentication with Email Magic Link and TOTP-based multi-factor authentication in your React application.

## Overview

When a user has MFA enabled, the authentication process requires two steps:
1. The user clicks the magic link sent to their email
2. The user enters the TOTP code from their authenticator app

## Implementation

### Step 1: Send the Magic Link

First, send a magic link to the user's email:

```tsx
import { useAuthenticate } from "@account-kit/react";

// Inside your component
const { authenticate } = useAuthenticate();

// When the user submits their email
const handleSendMagicLink = async (email: string) => {
  try {
    await authenticate({
      type: "email",
      emailMode: "magicLink",
      email,
    });
    // Success - inform user to check their email
  } catch (error) {
    // Handle error
  }
};
```

### Step 2: Handle the Magic Link with MFA

When the user clicks the magic link, you need to handle the possibility of MFA being required:

```tsx
import { useEffect } from "react";
import { useAuthenticate } from "@account-kit/react";
import { MfaRequiredError } from "@account-kit/signer";

// Inside your component
const { authenticate } = useAuthenticate();
const [mfaRequired, setMfaRequired] = useState(false);
const [mfaFactorId, setMfaFactorId] = useState("");
const [bundle, setBundle] = useState("");

// Handle the redirect when the component mounts
useEffect(() => {
  const handleRedirect = async () => {
    const url = new URL(window.location.href);
    const bundleParam = url.searchParams.get("bundle");
    
    if (bundleParam) {
      setBundle(bundleParam);
      
      try {
        await authenticate({
          type: "email",
          bundle: bundleParam,
        });
        // Authentication successful!
      } catch (error) {
        if (error instanceof MfaRequiredError) {
          // MFA is required
          setMfaRequired(true);
          setMfaFactorId(error.multiFactors[0].multiFactorId);
        } else {
          // Handle other errors
        }
      }
    }
  };

  handleRedirect();
}, [authenticate]);
```

### Step 3: Complete Authentication with MFA

If MFA is required, collect the TOTP code and complete authentication:

```tsx
import { useAuthenticate } from "@account-kit/react";

// Inside your component
const { authenticate } = useAuthenticate();

// When the user submits the TOTP code
const handleVerifyWithMfa = async (totpCode: string) => {
  try {
    await authenticate({
      type: "email",
      bundle,
      multiFactors: [
        {
          multiFactorId: mfaFactorId,
          multiFactorCode: totpCode,
        },
      ],
    });
    // Authentication successful!
  } catch (error) {
    // Handle error
  }
};
```

## Next Steps

- [Set up MFA for your users](/react/mfa/setup-mfa)
- [Implement Email OTP with MFA](/react/mfa/email-otp)