---
title: Retry User Operations
description: Learn how to use Drop and Replace to retry failing user operations.
slug: wallets/transactions/retry-user-operations
---

<Tabs>
  <Tab title="React">
    ## What is Drop and Replace?

    If fees change and your user operation gets stuck in the mempool, you can use drop and replace to resend the user operation with higher fees.

    Here's a quick example of how to use the `useDropAndReplaceUserOperation()` hook to drop and replace a user operation.

    ```tsx twoslash
    import React from "react";
    import { View, Pressable, Text } from "react-native";
    import {
      useDropAndReplaceUserOperation,
      useSendUserOperation,
      useSmartAccountClient,
    } from "@account-kit/react-native";

    export function ComponentWithDropAndReplaceUO() {
      const { client } = useSmartAccountClient({});

      const { sendUserOperationAsync, isSendingUserOperation } =
        useSendUserOperation({
          client,
        });

      const { dropAndReplaceUserOperation, isDroppingAndReplacingUserOperation } =
        useDropAndReplaceUserOperation({
          client,
          onSuccess: ({ hash, request }) => {
            // [optional] Do something with the hash and request
          },
          onError: (error) => {
            // [optional] Do something with the error
          },
          // [optional] ...additional mutationArgs
        });

      return (
        <View>
          <Pressable
            onPress={async () => {
              const { request } = await sendUserOperationAsync({
                uo: {
                  target: "0xTARGET_ADDRESS",
                  data: "0x",
                  value: 0n,
                },
              });

              dropAndReplaceUserOperation({
                uoToDrop: request,
              });
            }}
            disabled={isSendingUserOperation || isDroppingAndReplacingUserOperation}
          >
            <View>
              <Text>
                {isSendingUserOperation
                  ? "Sending..."
                  : isDroppingAndReplacingUserOperation
                    ? "Replacing..."
                    : "Send then Replace UO"}
              </Text>
            </View>
          </Pressable>
        </View>
      );
    }
    ```

    You can also build a more complex retry logic in a case you want more control over how many times you want to retry a failed user operation.

  </Tab>
  <Tab title="JavaScript">
    <Markdown src="../../shared/infra/drop-and-replace-description.mdx" />

    <CodeBlocks>

    ```ts twoslash example.ts
    import { client } from "./client";

    // 1. send a user operation
    const { hash, request } = await client.sendUserOperation({
      uo: {
        target: "0xTARGET_ADDRESS",
        data: "0x",
        value: 0n,
      },
    });

    try {
      // 2. wait for it to be mined
      const txHash = await client.waitForUserOperationTransaction({ hash });
    } catch (e) {
      // 3. if it fails, resubmit the user operation via drop and replace
      const { hash: newHash } = await client.dropAndReplaceUserOperation({
        uoToDrop: request,
      });

      // 4. wait for the new user operation to be mined
      await client.waitForUserOperationTransaction({ hash: newHash });
    }
    ```

    <Markdown src="../../shared/infra/client.mdx" />

    </CodeBlocks>

    In the above example, we only try to drop and replace once before failing completely, but you can build more complex retry logic using this combination of `waitForUserOperationTransaction` and `dropAndReplace`.

  </Tab>
</Tabs>
